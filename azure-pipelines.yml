trigger:
- main  # Adjust to your branch name

pool:
  vmImage: 'ubuntu-latest'

steps:
- task: PublishPipelineArtifact@1
  inputs:
    artifactName: 'PartnerDevices_Automation'
    path: 'C:/Users/v-adamarla/Desktop/AutomationApk/PartnerDevices_Automation'
  displayName: 'Publish Folder as Pipeline Artifact'

- task: DownloadPipelineArtifact@2
  inputs:
    artifactName: 'PartnerDevices_Automation'
    downloadPath: '/home/vsts/work/PartnerDevices_Automation'
  displayName: 'Download Pipeline Artifact'

- script: |
    echo "Building Docker image..."
    docker build -t my-custom-image:latest .
  displayName: 'Build Docker Image'

- script: |
    echo "Running Docker container..."
    docker run --name my-container -d my-custom-image:latest
  displayName: 'Run Docker Container'

- script: |
    echo "Copying artifact folder to Docker container..."
    docker cp /home/vsts/work/PartnerDevices_Automation my-container:/app/PartnerDevices_Automation
  displayName: 'Copy Folder to Docker Container'

- script: |
    echo "Creating symbolic links inside Docker container..."
    docker exec my-container /bin/bash -c "ln -sf /app/PartnerDevices_Automation/resources/Page_objects/Voicemail.json /app/PartnerDevices_Automation/resources/Page_objects/voicemail.json \
    && ln -sf /app/PartnerDevices_Automation/resources/Page_objects/Common.json /app/PartnerDevices_Automation/resources/Page_objects/common.json \
    && ln -sf /app/PartnerDevices_Automation/resources/Page_objects/People.json /app/PartnerDevices_Automation/resources/Page_objects/people.json"
  displayName: 'Create Symbolic Links'

- script: |
    echo "Running Robot Framework tests..."
    docker exec my-container /bin/bash -c "robot -d /results -i 237605 /app/PartnerDevices_Automation/tests_teams_room"
  displayName: 'Run Robot Framework Tests'

- script: |
    echo "Stopping Docker container..."
    docker stop my-container
    docker rm my-container
  displayName: 'Stop and Remove Docker Container'
